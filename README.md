# maxquant-service (主に暗号資産データサービス)

これは暗号資産（あんごうしさん）のデータ分析（ぶんせき）とバックテストのためのプロジェクトです。Spring Bootを使（つか）って作（つく）りました。

## 1. このプロジェクトでできること (主な機能)

このサービスを使（つか）うと、いろいろなことができます。

- **マーケットデータの取得（しゅとく）**
  - K-line（けいせん、「ローソク足」のこと）データや、リアルタイムの価格（かかく）データ、板（いた）情報（じょうほう）などをAPIで取（と）ってくることができます。
- **バックテスト機能（きのう）**
  - 自分（じぶん）で作（つく）った投資（とうし）の戦略（せんりゃく）が正（ただ）しいかどうか、過去（かこ）のデータを使（つか）ってテストすることができます。
  - テストのインスタンスを作（つく）ったり、レポートを見（み）たり、要（い）らなくなったら消（け）したりできます。
- **ユーザー管理（かんり）**
  - ユーザーを作（つく）ったり、パスワードを変（か）えたりできます。
- **戦略（せんりゃく）テンプレートの管理**
  - バックテストで使（つか）う戦略（せんりゃく）のテンプレートを保存（ほぞん）したり、読（よ）み出（だ）したりできます。
- **統計的分析（とうけいてきぶんせき）ツール**
  - ADF検定（けんてい）やHurst指数（しすう）など、専門的（せんもんてき）な分析（ぶんせき）を簡単（かんたん）に行（おこな）うAPIがあります。
- **データ同期（どうき）**
  - OKXやBinanceなど、外部（がいぶ）の取引所（とりひきじょ）から自動（じどう）でデータを集（あつ）めることができます。

## 2. 使（つか）われている技術（ぎじゅつ）

- **バックエンド**: Java 17, Spring Boot 3
- **データベース**:
  - **PostgreSQL**: ユーザーの情報（じょうほう）や戦略（せんりゃく）のテンプレートなどを保存（ほぞん）します。
  - **ClickHouse**: K-lineのような、とても大（おお）きなデータを速（はや）く分析（ぶんせき）するために使（つか）います。
- **ビルドツール**: Maven
- **その他**: WebSocket

## 3. プロジェクトを動（うご）かすために必要（ひつよう）なもの

あなたのコンピュータに、次（つぎ）のソフトウェアをインストールしてください。

- Java (JDK) 17 以上
- Maven 3.6 以上
- PostgreSQL サーバー
- ClickHouse サーバー

## 4. プロジェクトの実行方法（じっこうほうほう）

1. **プロジェクトをダウンロードします。**
   ```bash
   git clone <リポジトリのURL>
   cd maxquant-service
   ```

2. **設定（せってい）ファイルを変（か）えます。**
   `maxquant-service-app/src/main/resources/application.yml` というファイルを開（ひら）いてください。
   あなたのPostgreSQLとClickHouseのユーザー名（めい）、パスワードなどに直（なお）してください。

   ```yaml
   spring:
     datasource:
       url: jdbc:postgresql://localhost:5432/your_database # あなたのPostgreSQLデータベース
       username: your_username # あなたのユーザー名
       password: your_password # あなたのパスワード
     clickhouse:
       jdbc-url: jdbc:clickhouse://localhost:8123/your_clickhouse_db # あなたのClickHouseデータベース
       # ...
   ```

3. **Mavenでプロジェクトをビルドします。**
   コマンドプロンプト（ターミナル）で次（つぎ）のコマンドをタイプします。
   ```bash
   mvn clean install
   ```

4. **アプリケーションを実行（じっこう）します。**
   ビルドが成功（せいこう）したら、次（つぎ）のコマンドでサーバーをスタートします。
   ```bash
   java -jar maxquant-service-app/target/maxquant-service-app-1.0-SNAPSHOT.jar
   ```

5. **確認（かくにん）します。**
   サーバーは `http://localhost:8080` で動（うご）いています。ブラウザやAPIツールでアクセスしてみてください。

## 5. APIの概要（がいよう）

このプロジェクトにはたくさんのAPIがあります。主なものを紹介（しょうかい）します。

| 機能（きのう）                     | URLのプレフィックス                 | 説明（せつめい）                                     |
| ---------------------------------- | ----------------------------------- | ---------------------------------------------------- |
| ユーザー認証（にんしょう）         | `/api/v1/auth`                      | ログインやトークンのチェックをします。               |
| マーケットデータ                   | `/api/v1/market`                    | K-lineやリアルタイムの価格（かかく）などを取（と）ります。 |
| バックテストの実行（じっこう）     | `/api/v1/backtest`                  | Pythonのスクリプトでバックテストを動（うご）かします。|
| バックテストのインスタンス管理     | `/api/backtest-instances`           | バックテストのインスタンスを作（つく）ったり消（け）したりします。|
| バックテストのレポート             | `/api/backtest-reports`             | テスト結果（けっか）のレポートを見（み）ます。       |
| ユーザー管理                       | `/api/users`                        | ユーザーの管理（かんり）をします。                   |
| 戦略（せんりゃく）テンプレート     | `/api/strategy-templates`           | 戦略（せんりゃく）のテンプレートを管理（かんり）します。|
| 統計的裁定取引（とうけいてきさいていとりひき） | `/api/v1/statistical-arbitrage` | 専門的（せんもんてき）な統計分析（とうけいぶんせき）をします。 |
| データ同期（どうき）と修正（しゅうせい） | `/api/v1/data-correction`           | データのまちがいを直（なお）したりします。         |

**APIレスポンスの形（かたち）について**

すべてのAPIは、下（した）のような同（おな）じ形（かたち）のJSONを返（かえ）します。

- **成功（せいこう）したとき**:
  ```json
  {
    "code": 200,
    "message": "Success",
    "data": { ... } // ここに本当のデータが入っています
  }
  ```
- **失敗（しっぱい）したとき**:
  ```json
  {
    "code": 500, // エラーのコード
    "message": "エラーの理由", // エラーのメッセージ
    "data": null
  }
  ```
フロントエンドでAPIを使（つか）うときは、まず`code`が`200`かどうかをチェックしてください。

## 6. Pythonとの連携（れんけい）の仕組（しく）み

このプロジェクトのバックテスト機能（きのう）は、JavaとPythonが協力（きょうりょく）して動（うご）いています。その流（なが）れは次（つぎ）のようになっています。

1.  **フロントエンドからリクエスト**
    - ユーザーがブラウザでバックテストを開始（かいし）すると、リクエストがJavaの`BacktestController`に届（とど）きます。

2.  **JavaがPythonの準備（じゅんび）をする**
    - `BacktestServiceImpl`が、バックテストに必要（ひつよう）なすべての情報（じょうほう）（どの戦略（せんりゃく）を使（つか）うか、どのシンボルか、いつからいつまでのデータか等）をJSONファイルに書（か）き出（だ）します。
    - ユーザーが書（か）いた戦略（せんりゃく）のPythonコードも、一時的（いちじてき）な`.py`ファイルとして保存（ほぞん）します。

3.  **JavaがPythonを呼（よ）び出（だ）す**
    - Javaは、コンピュータのコマンドを使（つか）って、`backtest_runner.py`というPythonスクリプトを実行（じっこう）します。
    - このとき、コマンドの引数（ひきすう）として、ステップ2で作（つく）ったJSONファイルへのパスを渡（わた）します。
    - 例（たと）えば、`python3 launcher_new.py --config /tmp/config-12345.json` のようなコマンドが実行（じっこう）されます。

4.  **Pythonがバックテストを実行（じっこう）する**
    - `backtest_runner.py`は、渡（わた）されたJSONファイルを読（よ）んで、その設定（せってい）どおりにバックテストを始（はじ）めます。
    - テストの途中（とちゅう）で出（で）てくるログや結果（けっか）は、`print()`関数（かんすう）を使（つか）って標準出力（ひょうじゅんしゅつりょく）に書（か）き出（だ）します。

5.  **JavaがPythonからの情報（じょうほう）を受（う）け取（と）る**
    - Javaは、Pythonスクリプトの標準出力（ひょうじゅんしゅつりょく）をずっと読（よ）み続（つづ）けています。
    - Pythonが何かを`print()`するたびに、Javaはそれを一行（いちぎょう）ずつ受（う）け取（と）ります。

6.  **Javaがフロントエンドに情報（じょうほう）を送（おく）る**
    - Javaは、Pythonから受（う）け取（と）ったログや結果（けっか）を、WebSocketを使（つか）ってリアルタイムでフロントエンド（ブラウザ）に送（おく）ります。
    - これにより、ユーザーは自分のバックテストが今（いま）どうなっているか、すぐに見（み）ることができます。

このように、Javaは全体（ぜんたい）の管理（かんり）と通信（つうしん）を担当（たんとう）し、Pythonが実際（じっさい）の計算（けいさん）や分析（ぶんせき）を担当（たんとう）するという、役割分担（やくわりぶんたん）をしています。

